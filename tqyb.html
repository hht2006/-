<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é«˜çº§å¤©æ°”é¢„æŠ¥å¹³å°</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      :root {
        --primary: #1a2980;
        --secondary: #26d0ce;
        --accent: #ff6b6b;
        --light: #f8f9fa;
        --dark: #343a40;
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --gray: #6c757d;
        --moonlight: #e6e6fa;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: #333;
        min-height: 100vh;
        padding: 15px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        color: white;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .logo h1 {
        font-size: 1.8rem;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
      }

      .logo i {
        font-size: 2rem;
        color: var(--accent);
      }

      .search-box {
        display: flex;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 25px;
        overflow: hidden;
      }

      .search-box input {
        padding: 10px 20px;
        width: 250px;
        border: none;
        background: transparent;
        color: white;
        font-size: 1rem;
        outline: none;
      }

      .search-box input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .search-box button {
        padding: 10px 15px;
        border: none;
        background: var(--accent);
        color: white;
        cursor: pointer;
        transition: background 0.3s;
      }

      .search-box button:hover {
        background: #ff5252;
      }

      .view-tabs {
        display: flex;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        margin-bottom: 20px;
        overflow-x: auto;
      }

      .view-tab {
        padding: 12px 20px;
        cursor: pointer;
        transition: background 0.3s;
        color: white;
        white-space: nowrap;
        text-align: center;
        flex: 1;
        min-width: 120px;
      }

      .view-tab.active {
        background: rgba(255, 255, 255, 0.2);
        font-weight: bold;
      }

      .view-tab i {
        margin-right: 8px;
      }

      .view-content {
        display: none;
      }

      .view-content.active {
        display: block;
      }

      .card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      }

      .card-title {
        font-size: 1.3rem;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .main-dashboard {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }

      @media (min-width: 992px) {
        .main-dashboard {
          grid-template-columns: 1fr 1fr;
        }
      }

      @media (min-width: 1200px) {
        .main-dashboard {
          grid-template-columns: 1fr 1fr 1fr;
        }
      }

      .current-weather {
        text-align: center;
      }

      .location-info {
        margin-bottom: 15px;
      }

      .location-name {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary);
      }

      .location-date {
        color: var(--gray);
        font-size: 0.9rem;
      }

      .weather-icon {
        font-size: 4rem;
        margin: 10px 0;
      }

      .temperature {
        font-size: 3rem;
        font-weight: bold;
        color: var(--accent);
        margin: 5px 0;
      }

      .feels-like {
        font-size: 1rem;
        color: var(--gray);
        margin-bottom: 10px;
      }

      .weather-condition {
        font-size: 1.2rem;
        color: var(--dark);
        margin-bottom: 15px;
      }

      .weather-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .detail-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        background: rgba(26, 41, 128, 0.08);
        border-radius: 8px;
      }

      .detail-label {
        font-size: 0.8rem;
        color: var(--gray);
        margin-bottom: 5px;
      }

      .detail-value {
        font-weight: bold;
        color: var(--primary);
      }

      .hourly-forecast {
        overflow-x: auto;
        padding-bottom: 10px;
      }

      .hourly-container {
        display: flex;
        gap: 15px;
      }

      .hourly-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 80px;
        padding: 10px;
        background: rgba(26, 41, 128, 0.05);
        border-radius: 10px;
      }

      .hourly-time {
        font-weight: bold;
        color: var(--primary);
        font-size: 0.9rem;
      }

      .hourly-icon {
        font-size: 1.8rem;
        margin: 5px 0;
      }

      .hourly-temp {
        font-weight: bold;
        color: var(--accent);
      }

      .daily-forecast {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
      }

      .daily-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px;
        background: rgba(26, 41, 128, 0.05);
        border-radius: 10px;
        text-align: center;
      }

      .daily-day {
        font-weight: bold;
        color: var(--primary);
        margin-bottom: 10px;
      }

      .daily-icon {
        font-size: 2.5rem;
        margin: 5px 0;
      }

      .daily-high {
        font-weight: bold;
        color: var(--accent);
        font-size: 1.2rem;
      }

      .daily-low {
        color: var(--gray);
        margin-bottom: 5px;
      }

      .moon-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }

      .moon-phase {
        font-size: 2rem;
        margin-bottom: 10px;
      }

      .moon-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        width: 100%;
      }

      .moon-detail {
        text-align: center;
        padding: 8px;
        background: rgba(230, 230, 250, 0.3);
        border-radius: 8px;
      }

      .moon-label {
        font-size: 0.8rem;
        color: var(--gray);
      }

      .moon-value {
        font-weight: bold;
        color: #4b0082;
      }

      .extended-forecast {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
      }

      .extended-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px;
        background: rgba(26, 41, 128, 0.05);
        border-radius: 10px;
        text-align: center;
      }

      .extended-day {
        font-weight: bold;
        color: var(--primary);
        margin-bottom: 10px;
      }

      .extended-icon {
        font-size: 2rem;
        margin: 5px 0;
      }

      .extended-high {
        font-weight: bold;
        color: var(--accent);
      }

      .extended-low {
        color: var(--gray);
        margin-bottom: 5px;
      }

      .extended-moon {
        font-size: 1.5rem;
        margin-top: 5px;
      }

      .map-container {
        height: 400px;
        border-radius: 12px;
        overflow: hidden;
      }

      .map-tabs {
        display: flex;
        margin-bottom: 15px;
        background: rgba(26, 41, 128, 0.1);
        border-radius: 10px;
        overflow: hidden;
      }

      .map-tab {
        padding: 10px 15px;
        cursor: pointer;
        text-align: center;
        flex: 1;
        transition: background 0.3s;
      }

      .map-tab.active {
        background: var(--primary);
        color: white;
      }

      .map-content {
        display: none;
      }

      .map-content.active {
        display: block;
      }

      .typhoon-alert {
        background: linear-gradient(135deg, #ff8a00, #da1b60);
        color: white;
      }

      .alert-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .alert-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.3rem;
      }

      .alert-badge {
        background: var(--danger);
        color: white;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
      }

      .alert-content {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
      }

      @media (min-width: 768px) {
        .alert-content {
          grid-template-columns: 1fr 1fr;
        }
      }

      .alert-info {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .alert-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }

      .alert-label {
        font-weight: bold;
      }

      .alert-value {
        font-weight: bold;
      }

      .air-quality {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
      }

      .aqi-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px;
        background: rgba(26, 41, 128, 0.05);
        border-radius: 10px;
        text-align: center;
      }

      .aqi-value {
        font-size: 2rem;
        font-weight: bold;
        margin: 5px 0;
      }

      .aqi-label {
        font-size: 0.9rem;
        color: var(--gray);
      }

      .good {
        color: var(--success);
      }

      .moderate {
        color: var(--warning);
      }

      .unhealthy {
        color: var(--danger);
      }

      footer {
        text-align: center;
        color: white;
        padding: 20px 0;
        font-size: 0.9rem;
        margin-top: 20px;
      }

      .loading {
        text-align: center;
        padding: 30px;
        color: var(--gray);
      }

      .loading i {
        font-size: 2rem;
        margin-bottom: 10px;
        color: var(--primary);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo">
          <i class="fas fa-cloud-sun-rain"></i>
          <h1>æ°”è±¡é¢„è­¦å¹³å°</h1>
        </div>
        <div class="search-box">
          <input type="text" placeholder="æœç´¢åŸå¸‚æˆ–åœ°åŒº..." />
          <button><i class="fas fa-search"></i></button>
        </div>
      </header>

      <div class="view-tabs">
        <div class="view-tab active" data-view="dashboard">
          <i class="fas fa-th-large"></i> æ€»è§ˆ
        </div>
        <div class="view-tab" data-view="map">
          <i class="fas fa-map-marked-alt"></i> æ°”è±¡åœ°å›¾
        </div>
        <div class="view-tab" data-view="typhoon">
          <i class="fas fa-wind"></i> å°é£è·¯å¾„
        </div>
        <div class="view-tab" data-view="radar">
          <i class="fas fa-satellite"></i> é›·è¾¾å›¾
        </div>
        <div class="view-tab" data-view="aqi">
          <i class="fas fa-wind"></i> ç©ºæ°”è´¨é‡
        </div>
        <div class="view-tab" data-view="warning">
          <i class="fas fa-exclamation-triangle"></i> é¢„è­¦ä¿¡æ¯
        </div>
      </div>

      <!-- æ€»è§ˆè§†å›¾ -->
      <div class="view-content active" id="dashboard-view">
        <div class="main-dashboard">
          <div class="card current-weather">
            <div class="location-info">
              <div class="location-name">åŒ—äº¬å¸‚</div>
              <div class="location-date">2023å¹´11æœˆ15æ—¥ æ˜ŸæœŸä¸‰ 15:30</div>
            </div>
            <div class="weather-icon">ğŸŒ¤ï¸</div>
            <div class="temperature">23Â°C</div>
            <div class="feels-like">ä½“æ„Ÿæ¸©åº¦: 25Â°C</div>
            <div class="weather-condition">æ™´é—´å¤šäº‘</div>

            <div class="weather-details">
              <div class="detail-item">
                <div class="detail-label">æ¹¿åº¦</div>
                <div class="detail-value">65%</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">é£é€Ÿ</div>
                <div class="detail-value">3.5 m/s</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">æ°”å‹</div>
                <div class="detail-value">1015 hPa</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">èƒ½è§åº¦</div>
                <div class="detail-value">10 km</div>
              </div>
            </div>

            <div class="moon-info">
              <div class="moon-phase">ğŸŒ“</div>
              <div class="moon-details">
                <div class="moon-detail">
                  <div class="moon-label">æœˆå‡º</div>
                  <div class="moon-value">18:23</div>
                </div>
                <div class="moon-detail">
                  <div class="moon-label">æœˆè½</div>
                  <div class="moon-value">07:45</div>
                </div>
                <div class="moon-detail">
                  <div class="moon-label">æœˆç›¸</div>
                  <div class="moon-value">ä¸Šå¼¦æœˆ</div>
                </div>
                <div class="moon-detail">
                  <div class="moon-label">ç…§æ˜</div>
                  <div class="moon-value">52%</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-clock"></i> 24å°æ—¶é¢„æŠ¥
              </div>
            </div>
            <div class="hourly-forecast">
              <div class="hourly-container">
                <!-- å°æ—¶é¢„æŠ¥å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-calendar-day"></i> 7å¤©é¢„æŠ¥
              </div>
            </div>
            <div class="daily-forecast">
              <!-- æ¯æ—¥é¢„æŠ¥å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-calendar-week"></i> 3-7å¤©é¢„æŠ¥
              </div>
            </div>
            <div class="extended-forecast" id="extended-forecast">
              <!-- 3-7å¤©é¢„æŠ¥å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-lungs"></i> ç©ºæ°”è´¨é‡
              </div>
            </div>
            <div class="air-quality">
              <div class="aqi-item">
                <div class="aqi-label">AQIæŒ‡æ•°</div>
                <div class="aqi-value good">42</div>
                <div class="aqi-label">è‰¯å¥½</div>
              </div>
              <div class="aqi-item">
                <div class="aqi-label">PM2.5</div>
                <div class="aqi-value good">18</div>
                <div class="aqi-label">Î¼g/mÂ³</div>
              </div>
              <div class="aqi-item">
                <div class="aqi-label">PM10</div>
                <div class="aqi-value good">32</div>
                <div class="aqi-label">Î¼g/mÂ³</div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title"><i class="fas fa-sun"></i> æ—¥å‡ºæ—¥è½</div>
            </div>
            <div class="weather-details">
              <div class="detail-item">
                <div class="detail-label">æ—¥å‡º</div>
                <div class="detail-value">06:45</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">æ—¥è½</div>
                <div class="detail-value">17:20</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">æ—¥ç…§æ—¶é•¿</div>
                <div class="detail-value">10h 35m</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">ç´«å¤–çº¿</div>
                <div class="detail-value">ä¸­ç­‰</div>
              </div>
            </div>
          </div>

          <div class="card typhoon-alert">
            <div class="alert-header">
              <div class="alert-title">
                <i class="fas fa-exclamation-triangle"></i>
                <span>å°é£é¢„è­¦</span>
              </div>
              <div class="alert-badge">çº¢è‰²é¢„è­¦</div>
            </div>
            <div class="alert-content">
              <div class="alert-info">
                <div class="alert-item">
                  <span class="alert-label">å°é£åç§°:</span>
                  <span class="alert-value">æ¢…èŠ±</span>
                </div>
                <div class="alert-item">
                  <span class="alert-label">å½“å‰å¼ºåº¦:</span>
                  <span class="alert-value">å¼ºå°é£</span>
                </div>
                <div class="alert-item">
                  <span class="alert-label">ä¸­å¿ƒæ°”å‹:</span>
                  <span class="alert-value">935 hPa</span>
                </div>
              </div>
              <div class="alert-info">
                <div class="alert-item">
                  <span class="alert-label">æœ€å¤§é£é€Ÿ:</span>
                  <span class="alert-value">48 m/s</span>
                </div>
                <div class="alert-item">
                  <span class="alert-label">ç§»åŠ¨é€Ÿåº¦:</span>
                  <span class="alert-value">15 km/h</span>
                </div>
                <div class="alert-item">
                  <span class="alert-label">é¢„è®¡ç™»é™†:</span>
                  <span class="alert-value">æµ™æ±Ÿæ²¿æµ·</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ°”è±¡åœ°å›¾è§†å›¾ -->
      <div class="view-content" id="map-view">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <i class="fas fa-map-marked-alt"></i> æ°”è±¡åœ°å›¾
            </div>
          </div>
          <div class="map-tabs">
            <div class="map-tab active" data-map="wind">é£åœº</div>
            <div class="map-tab" data-map="temperature">æ¸©åº¦</div>
            <div class="map-tab" data-map="precipitation">é™æ°´</div>
            <div class="map-tab" data-map="pressure">æ°”å‹</div>
            <div class="map-tab" data-map="clouds">äº‘é‡</div>
          </div>

          <div class="map-content active" id="wind-map">
            <div class="map-container" id="wind-map-container"></div>
          </div>

          <div class="map-content" id="temperature-map">
            <div class="map-container" id="temp-map-container"></div>
          </div>

          <div class="map-content" id="precipitation-map">
            <div class="map-container" id="precip-map-container"></div>
          </div>

          <div class="map-content" id="pressure-map">
            <div class="map-container" id="pressure-map-container"></div>
          </div>

          <div class="map-content" id="clouds-map">
            <div class="map-container" id="clouds-map-container"></div>
          </div>
        </div>
      </div>

      <!-- å…¶ä»–è§†å›¾å†…å®¹ -->
      <div class="view-content" id="typhoon-view">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <i class="fas fa-wind"></i> å°é£è·¯å¾„è¿½è¸ª
            </div>
          </div>
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>æ­£åœ¨åŠ è½½å°é£æ•°æ®...</p>
          </div>
        </div>
      </div>

      <div class="view-content" id="radar-view">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <i class="fas fa-satellite"></i> æ°”è±¡é›·è¾¾
            </div>
          </div>
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>æ­£åœ¨åŠ è½½é›·è¾¾æ•°æ®...</p>
          </div>
        </div>
      </div>

      <div class="view-content" id="aqi-view">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <i class="fas fa-lungs"></i> ç©ºæ°”è´¨é‡æŒ‡æ•°
            </div>
          </div>
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>æ­£åœ¨åŠ è½½ç©ºæ°”è´¨é‡æ•°æ®...</p>
          </div>
        </div>
      </div>

      <div class="view-content" id="warning-view">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <i class="fas fa-exclamation-triangle"></i> æ°”è±¡é¢„è­¦ä¿¡æ¯
            </div>
          </div>
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>æ­£åœ¨åŠ è½½é¢„è­¦ä¿¡æ¯...</p>
          </div>
        </div>
      </div>

      <footer>
        <p>
          æ•°æ®æ¥æº: ä¸­å¤®æ°”è±¡å°ã€Windy.comã€OpenWeatherMap | æ›´æ–°äº:
          <span id="update-time">2023-11-15 15:30:00</span>
        </p>
      </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
      // æœˆäº®æ•°æ®
      const moonPhases = ["ğŸŒ‘", "ğŸŒ’", "ğŸŒ“", "ğŸŒ”", "ğŸŒ•", "ğŸŒ–", "ğŸŒ—", "ğŸŒ˜"];
      const moonPhaseNames = [
        "æ–°æœˆ",
        "å¨¥çœ‰æœˆ",
        "ä¸Šå¼¦æœˆ",
        "ç›ˆå‡¸æœˆ",
        "æ»¡æœˆ",
        "äºå‡¸æœˆ",
        "ä¸‹å¼¦æœˆ",
        "æ®‹æœˆ",
      ];

      // åˆå§‹åŒ–æ‰€æœ‰åœ°å›¾
      function initMaps() {
        const windMap = L.map("wind-map-container").setView([35, 105], 4);
        const tempMap = L.map("temp-map-container").setView([35, 105], 4);
        const precipMap = L.map("precip-map-container").setView([35, 105], 4);
        const pressureMap = L.map("pressure-map-container").setView(
          [35, 105],
          4
        );
        const cloudsMap = L.map("clouds-map-container").setView([35, 105], 4);

        // æ·»åŠ åœ°å›¾å›¾å±‚
        const osmLayer = L.tileLayer(
          "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
          {
            attribution: "&copy; OpenStreetMap contributors",
          }
        );

        osmLayer.addTo(windMap);
        osmLayer.addTo(tempMap);
        osmLayer.addTo(precipMap);
        osmLayer.addTo(pressureMap);
        osmLayer.addTo(cloudsMap);

        // æ¨¡æ‹Ÿæ·»åŠ ä¸€äº›æ°”è±¡æ•°æ®
        addMockWeatherData(windMap, "wind");
        addMockWeatherData(tempMap, "temp");
        addMockWeatherData(precipMap, "precip");
        addMockWeatherData(pressureMap, "pressure");
        addMockWeatherData(cloudsMap, "clouds");

        return { windMap, tempMap, precipMap, pressureMap, cloudsMap };
      }

      // æ·»åŠ æ¨¡æ‹Ÿæ°”è±¡æ•°æ®
      function addMockWeatherData(map, type) {
        const dataPoints = [
          {
            lat: 39.9,
            lng: 116.4,
            value:
              type === "wind"
                ? 3.5
                : type === "temp"
                ? 23
                : type === "precip"
                ? 0.1
                : type === "pressure"
                ? 1015
                : 30,
          },
          {
            lat: 31.2,
            lng: 121.5,
            value:
              type === "wind"
                ? 4.2
                : type === "temp"
                ? 26
                : type === "precip"
                ? 0.8
                : type === "pressure"
                ? 1010
                : 80,
          },
          {
            lat: 23.1,
            lng: 113.3,
            value:
              type === "wind"
                ? 2.8
                : type === "temp"
                ? 30
                : type === "precip"
                ? 0.5
                : type === "pressure"
                ? 1008
                : 60,
          },
          {
            lat: 30.6,
            lng: 104.1,
            value:
              type === "wind"
                ? 1.5
                : type === "temp"
                ? 22
                : type === "precip"
                ? 0.2
                : type === "pressure"
                ? 1012
                : 40,
          },
          {
            lat: 43.8,
            lng: 87.6,
            value:
              type === "wind"
                ? 5.3
                : type === "temp"
                ? 18
                : type === "precip"
                ? 0.0
                : type === "pressure"
                ? 1020
                : 10,
          },
        ];

        dataPoints.forEach((point) => {
          let color, radius, popupText;

          switch (type) {
            case "wind":
              color = "#3388ff";
              radius = point.value * 3;
              popupText = `é£é€Ÿ: ${point.value} m/s`;
              break;
            case "temp":
              color =
                point.value > 25
                  ? "#ff5252"
                  : point.value > 20
                  ? "#ffb142"
                  : "#3498db";
              radius = 10;
              popupText = `æ¸©åº¦: ${point.value}Â°C`;
              break;
            case "precip":
              color =
                point.value > 0.5
                  ? "#3498db"
                  : point.value > 0.2
                  ? "#3498db"
                  : "#3498db";
              radius = point.value * 30;
              popupText = `é™æ°´: ${point.value} mm`;
              break;
            case "pressure":
              color =
                point.value > 1015
                  ? "#ff5252"
                  : point.value > 1010
                  ? "#ffb142"
                  : "#3498db";
              radius = 10;
              popupText = `æ°”å‹: ${point.value} hPa`;
              break;
            case "clouds":
              color =
                point.value > 60
                  ? "#7f8c8d"
                  : point.value > 30
                  ? "#bdc3c7"
                  : "#ecf0f1";
              radius = point.value / 3;
              popupText = `äº‘é‡: ${point.value}%`;
              break;
          }

          L.circleMarker([point.lat, point.lng], {
            radius: radius,
            color: color,
            fillColor: color,
            fillOpacity: 0.7,
          })
            .addTo(map)
            .bindPopup(popupText);
        });
      }

      // ç”Ÿæˆ24å°æ—¶é¢„æŠ¥
      function generateHourlyForecast() {
        const container = document.querySelector(".hourly-container");
        container.innerHTML = "";

        const now = new Date();

        for (let i = 0; i < 24; i++) {
          const hour = new Date(now.getTime() + i * 60 * 60 * 1000);
          const hourStr = hour.getHours().toString().padStart(2, "0") + ":00";
          const temp = Math.round(20 + Math.sin(i / 4) * 5);

          const hourlyItem = document.createElement("div");
          hourlyItem.className = "hourly-item";
          hourlyItem.innerHTML = `
                    <div class="hourly-time">${hourStr}</div>
                    <div class="hourly-icon">${
                      i % 6 === 0 ? "ğŸŒ§ï¸" : i % 4 === 0 ? "â›…" : "ğŸŒ¤ï¸"
                    }</div>
                    <div class="hourly-temp">${temp}Â°C</div>
                `;

          container.appendChild(hourlyItem);
        }
      }

      // ç”Ÿæˆ7å¤©é¢„æŠ¥
      function generateDailyForecast() {
        const container = document.querySelector(".daily-forecast");
        container.innerHTML = "";

        const days = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];
        const now = new Date();

        for (let i = 0; i < 7; i++) {
          const day = new Date(now.getTime() + i * 24 * 60 * 60 * 1000);
          const dayStr = i === 0 ? "ä»Šå¤©" : days[day.getDay()];
          const highTemp = Math.round(22 + Math.sin(i) * 5);
          const lowTemp = Math.round(highTemp - 5 - Math.random() * 3);

          const dailyItem = document.createElement("div");
          dailyItem.className = "daily-item";
          dailyItem.innerHTML = `
                    <div class="daily-day">${dayStr}</div>
                    <div class="daily-icon">${
                      i % 7 === 3 ? "ğŸŒ§ï¸" : i % 7 === 6 ? "â›…" : "ğŸŒ¤ï¸"
                    }</div>
                    <div class="daily-high">${highTemp}Â°C</div>
                    <div class="daily-low">${lowTemp}Â°C</div>
                `;

          container.appendChild(dailyItem);
        }
      }

      // ç”Ÿæˆ3-7å¤©é¢„æŠ¥
      function generateExtendedForecast() {
        const container = document.getElementById("extended-forecast");
        container.innerHTML = "";

        const days = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];
        const now = new Date();

        for (let i = 3; i < 8; i++) {
          const day = new Date(now.getTime() + i * 24 * 60 * 60 * 1000);
          const dayStr = days[day.getDay()];
          const highTemp = Math.round(20 + Math.sin(i / 2) * 6);
          const lowTemp = Math.round(highTemp - 6 - Math.random() * 3);
          const moonPhaseIndex = Math.floor(Math.random() * moonPhases.length);

          const extendedItem = document.createElement("div");
          extendedItem.className = "extended-item";
          extendedItem.innerHTML = `
                    <div class="extended-day">${dayStr}</div>
                    <div class="extended-icon">${
                      i % 7 === 4 ? "ğŸŒ§ï¸" : i % 7 === 6 ? "â›…" : "ğŸŒ¤ï¸"
                    }</div>
                    <div class="extended-high">${highTemp}Â°C</div>
                    <div class="extended-low">${lowTemp}Â°C</div>
                    <div class="extended-moon">${
                      moonPhases[moonPhaseIndex]
                    }</div>
                    <div class="moon-value">${
                      moonPhaseNames[moonPhaseIndex]
                    }</div>
                `;

          container.appendChild(extendedItem);
        }
      }

      // è®¡ç®—æœˆå‡ºæœˆè½æ—¶é—´ï¼ˆæ¨¡æ‹Ÿï¼‰
      function calculateMoonTimes() {
        const moonRiseHour = 17 + Math.floor(Math.random() * 3);
        const moonRiseMinute = Math.floor(Math.random() * 60);
        const moonSetHour = 5 + Math.floor(Math.random() * 3);
        const moonSetMinute = Math.floor(Math.random() * 60);

        return {
          rise: `${moonRiseHour.toString().padStart(2, "0")}:${moonRiseMinute
            .toString()
            .padStart(2, "0")}`,
          set: `${moonSetHour.toString().padStart(2, "0")}:${moonSetMinute
            .toString()
            .padStart(2, "0")}`,
        };
      }

      // åˆå§‹åŒ–æ ‡ç­¾é¡µåŠŸèƒ½
      function initTabs() {
        // ä¸»è§†å›¾æ ‡ç­¾
        document.querySelectorAll(".view-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            document
              .querySelectorAll(".view-tab")
              .forEach((t) => t.classList.remove("active"));
            document
              .querySelectorAll(".view-content")
              .forEach((t) => t.classList.remove("active"));

            tab.classList.add("active");
            document
              .getElementById(`${tab.dataset.view}-view`)
              .classList.add("active");
          });
        });

        // åœ°å›¾ç±»å‹æ ‡ç­¾
        document.querySelectorAll(".map-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            document
              .querySelectorAll(".map-tab")
              .forEach((t) => t.classList.remove("active"));
            document
              .querySelectorAll(".map-content")
              .forEach((t) => t.classList.remove("active"));

            tab.classList.add("active");
            document
              .getElementById(`${tab.dataset.map}-map`)
              .classList.add("active");
          });
        });
      }

      // åˆå§‹åŒ–é¡µé¢
      function initPage() {
        const maps = initMaps();
        generateHourlyForecast();
        generateDailyForecast();
        generateExtendedForecast();
        initTabs();

        // è®¾ç½®å½“å‰æ—¥æœŸ
        const now = new Date();
        const options = {
          year: "numeric",
          month: "long",
          day: "numeric",
          weekday: "long",
        };
        document.querySelector(".location-date").textContent =
          now.toLocaleDateString("zh-CN", options) +
          " " +
          now.toLocaleTimeString("zh-CN", {
            hour: "2-digit",
            minute: "2-digit",
          });

        // è®¾ç½®æ›´æ–°æ—¶é—´
        document.getElementById("update-time").textContent =
          now.toLocaleString("zh-CN");

        // è®¾ç½®æœˆå‡ºæœˆè½æ—¶é—´
        const moonTimes = calculateMoonTimes();
        document.querySelector(
          ".moon-detail:nth-child(1) .moon-value"
        ).textContent = moonTimes.rise;
        document.querySelector(
          ".moon-detail:nth-child(2) .moon-value"
        ).textContent = moonTimes.set;

        // æœç´¢åŠŸèƒ½
        document
          .querySelector(".search-box button")
          .addEventListener("click", () => {
            const query = document
              .querySelector(".search-box input")
              .value.trim();
            if (query) {
              document.querySelector(".location-name").textContent = query;
              alert(`æ­£åœ¨æœç´¢: ${query}ï¼Œå®é™…åº”ç”¨ä¸­ä¼šè°ƒç”¨APIè·å–æ•°æ®`);
            }
          });

        // å“åº”å¼è°ƒæ•´åœ°å›¾å¤§å°
        window.addEventListener("resize", () => {
          setTimeout(() => {
            Object.values(maps).forEach((map) => map.invalidateSize());
          }, 100);
        });
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      window.onload = initPage;
    </script>
  </body>
</html>
